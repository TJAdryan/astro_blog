---

---

<button
    id="holiday-toggle"
    class="holiday-toggle"
    aria-label="Toggle Holiday Mode"
    hidden
>
    ðŸŽ„ Holiday Mode
</button>

<div id="holiday-decorations" hidden>
    <div class="ornaments-right"></div>
</div>

<script>
    function initHolidayMode() {
        const toggleBtn = document.getElementById("holiday-toggle");
        const decorations = document.getElementById("holiday-decorations");
        if (!toggleBtn || !decorations) return;

        const now = new Date();
        const currentYear = now.getFullYear();
        const start = new Date(currentYear, 11, 10); // Dec 10
        const end = new Date(currentYear, 11, 31, 23, 59, 59); // Dec 31 end of day

        // Check if within date range
        if (now >= start && now <= end) {
            toggleBtn.hidden = false;

            // Check stored preference. Default to true if not explicitly disabled.
            const storedMode = localStorage.getItem("holiday-mode");
            if (storedMode !== "false") {
                enableHolidayMode();
            }

            toggleBtn.addEventListener("click", () => {
                const isActive =
                    document.documentElement.classList.contains("holiday-mode");
                if (isActive) {
                    disableHolidayMode();
                } else {
                    enableHolidayMode();
                }
            });
        }

        function enableHolidayMode() {
            document.documentElement.classList.add("holiday-mode");
            localStorage.setItem("holiday-mode", "true");
            toggleBtn.classList.add("active");
            startSnow();
        }

        function disableHolidayMode() {
            document.documentElement.classList.remove("holiday-mode");
            localStorage.setItem("holiday-mode", "false");
            toggleBtn.classList.remove("active");
        }

        function startSnow() {
            // Avoid duplicate snow if already snowing
            if (document.getElementById("snow-container")) return;

            const snowContainer = document.createElement("div");
            snowContainer.id = "snow-container";
            Object.assign(snowContainer.style, {
                position: "fixed",
                top: "0",
                left: "0",
                width: "100%",
                height: "100%",
                pointerEvents: "none",
                zIndex: "9999",
                overflow: "hidden",
            });

            // Add keyframes if not exists
            if (!document.getElementById("snow-keyframes")) {
                const style = document.createElement("style");
                style.id = "snow-keyframes";
                style.textContent = `
                    @keyframes fall {
                        0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
                        100% { transform: translateY(100vh) rotate(360deg); opacity: 0.7; }
                    }
                `;
                document.head.appendChild(style);
            }

            const numberOfSnowflakes = 50;
            for (let i = 0; i < numberOfSnowflakes; i++) {
                const snowflake = document.createElement("div");
                snowflake.textContent = "â„";
                Object.assign(snowflake.style, {
                    position: "absolute",
                    top: "-20px",
                    left: Math.random() * 100 + "%",
                    opacity: Math.random(),
                    fontSize: Math.random() * 20 + 10 + "px",
                    color: "#aaddff", // Light blue, visible on generic backgrounds
                    textShadow: "0 0 2px rgba(0,0,0,0.3)",
                    animation: `fall ${Math.random() * 3 + 2}s linear infinite`,
                });
                snowContainer.appendChild(snowflake);
            }

            document.body.appendChild(snowContainer);

            // Remove after 5 seconds (5000ms)
            setTimeout(() => {
                snowContainer.style.transition = "opacity 1s";
                snowContainer.style.opacity = "0";
                setTimeout(() => {
                    snowContainer.remove();
                }, 1000);
            }, 5000);
        }
    }

    // Run on load
    initHolidayMode();

    // Re-run on view transitions if enabled
    document.addEventListener("astro:page-load", initHolidayMode);
</script>

<style is:global>
    /* Toggle Button Styles */
    .holiday-toggle {
        background: transparent;
        border: none;
        padding: 0.5em 1em;
        font-size: 0.9em;
        cursor: pointer;
        font-family: inherit;
        color: inherit;
        transition: all 0.2s;
        margin-left: 1em;
    }

    .holiday-toggle:hover {
        background: rgba(46, 139, 87, 0.1); /* Subtle green tint */
        border-color: #2e8b57;
        color: #2e8b57;
    }

    .holiday-toggle.active {
        background: #2e8b57; /* Forest Green for a more classic look */
        color: white;
        border-color: #2e8b57;
    }
</style>
